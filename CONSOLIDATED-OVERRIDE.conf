# ==========================================
# CONSOLIDATED SYSTEMD OVERRIDE (NO DUPLICATES)
# Replace ALL existing override files with this single file
# Place at: /etc/systemd/system/bist-pattern.service.d/99-consolidated.conf
# ==========================================

[Service]

# ==========================================
# CORE SYSTEM
# ==========================================
Environment="PYTHONPATH=/opt/bist-pattern"

# ==========================================
# SECURITY (GENERATED TOKENS)
# ==========================================
Environment="FLASK_SECRET_KEY=IuYBykJ-c0-vOv1rd4wskXrkLAHXuUABKRxrLnHCs1rskbFK40Ud5iXqUpgNcdelPZl9AoGUJPnImN0KxnNgUA"
Environment="JWT_SECRET_KEY=TJcofAvIHSUw_NUvIaCWR3CMA0YNJUOONU5GINcyX_sEw7u_f5tZjW0-NabuWuKgFmLreTce7vHvLc5ek2KQag"
Environment="INTERNAL_API_TOKEN=IBx_gsmQUL9oxymAgr67PxES7ACfKlk1Ex5F9jCCOFw"

# Admin Account
Environment="ADMIN_EMAIL=admin@cls.aile.gov.tr"
Environment="ADMIN_DEFAULT_PASSWORD=__ADMIN_STRONG_PASSWORD__"

# ==========================================
# DATABASE (SECURE)
# ==========================================
Environment="DATABASE_URL=postgresql://bist_user:5ex5chan5GE5*@127.0.0.1:5432/bist_pattern_db"
Environment="DB_HOST=localhost"
Environment="DB_PORT=5432"
Environment="DB_NAME=bist_pattern_db"
Environment="DB_USER=bist_user"
# DB_PASSWORD removed - using secure file instead

# ==========================================
# REDIS & MESSAGING
# ==========================================
Environment="REDIS_URL=redis://127.0.0.1:6379/0"
Environment="SOCKETIO_MESSAGE_QUEUE=redis://127.0.0.1:6379/0"

# ==========================================
# SSL/HTTPS (PRODUCTION)
# ==========================================
Environment="SESSION_COOKIE_SECURE=True"
Environment="REMEMBER_COOKIE_SECURE=True"
Environment="PREFERRED_URL_SCHEME=https"
Environment="SOCKETIO_ALLOW_HTTP=False"

# ==========================================
# CORS SECURITY
# ==========================================
Environment="CORS_ORIGINS=https://cls.aile.gov.tr,https://lotlot.net,https://www.lotlot.net"

# ==========================================
# WEBSOCKET CONFIGURATION
# ==========================================
Environment="SOCKETIO_PING_TIMEOUT=60"
Environment="SOCKETIO_PING_INTERVAL=30"
Environment="ENGINEIO_DEBUG=0"

# ==========================================
# GUNICORN CONFIGURATION
# ==========================================
Environment="GUNICORN_WORKERS=1"
Environment="GUNICORN_WORKER_CLASS=geventwebsocket.gunicorn.workers.GeventWebSocketWorker"
Environment="GUNICORN_TIMEOUT=1800"
Environment="GUNICORN_BIND=0.0.0.0:5000"

# ==========================================
# THREADING LIMITS
# ==========================================
Environment="COLLECTOR_MAX_WORKERS=2"
Environment="ML_ASYNC_WORKERS=2"
Environment="VISUAL_ASYNC_WORKERS=1"
Environment="PATTERN_COORDINATOR_WORKERS=1"
Environment="TOTAL_MAX_THREADS=8"

# ==========================================
# PATHS & DIRECTORIES
# ==========================================
Environment="BIST_LOG_PATH=/opt/bist-pattern/logs"
Environment="YOLO_MODEL_PATH=/opt/bist-pattern/yolo/patterns_all_v7_rectblend.pt"
Environment="ML_MODEL_PATH=/opt/bist-pattern/.cache/enhanced_ml_models"
Environment="CATBOOST_TRAIN_DIR=/opt/bist-pattern/.cache/catboost"
Environment="TRANSFORMERS_CACHE=/opt/bist-pattern/cache/huggingface"
Environment="HF_HOME=/opt/bist-pattern/cache/huggingface"

# ==========================================
# FEATURE FLAGS
# ==========================================
Environment="ENABLE_ENHANCED_ML=True"
Environment="ENABLE_BASIC_ML=True"
Environment="ENABLE_FINGPT=True"
Environment="ENABLE_YOLO=True"
Environment="ENABLE_YAHOO_FALLBACK=True"
Environment="YF_ENHANCED_ENABLED=True"

# ==========================================
# CACHE CONFIGURATION
# ==========================================
Environment="DATA_CACHE_TTL=60"
Environment="PATTERN_CACHE_TTL=300"

# ==========================================
# AUTOMATION & PIPELINE
# ==========================================
Environment="AUTO_START_PIPELINE=True"
Environment="SYMBOL_FLOW=1"
Environment="SYMBOL_SLEEP_SECONDS=0.1"
Environment="FULL_CYCLE_SLEEP_SECONDS=1800"
Environment="STATUS_GRACE_SECONDS=10"
Environment="RUNNING_FLAG_KEY=automation:running"
Environment="RUNNING_FLAG_TTL=120"
Environment="RUNNING_FLAG_HEARTBEAT_SECONDS=30"

# ==========================================
# DATA COLLECTION
# ==========================================
Environment="COLLECTOR_DELAY_RANGE=1,3"
Environment="MAX_SYMBOLS_PER_COLLECTION=10000"

# ==========================================
# YAHOO FINANCE
# ==========================================
Environment="YF_BACKOFF_BASE_SECONDS=2.0"
Environment="YF_BURST_DELAY=10.0"
Environment="YF_BURST_THRESHOLD=5"
Environment="YF_FALLBACK_TIMEOUT=60.0"
Environment="YF_MAX_DELAY=6.0"
Environment="YF_MAX_RETRIES=3"
Environment="YF_MIN_DELAY=2.0"
Environment="YF_SESSION_POOL_SIZE=5"
Environment="YF_SINGLE_SESSION=default"
Environment="YF_TRY_ALT_PERIODS=0"
Environment="YF_USER_AGENTS=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124 Safari/537.36|Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120 Safari/537.36|Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15 Safari/537.36"
Environment="YF_YFINANCE_TRIES=1"

# ==========================================
# MACHINE LEARNING
# ==========================================
Environment="ML_TRAIN_INTERVAL_CYCLES=1"
Environment="ML_TRAIN_PER_CYCLE=50"

# ==========================================
# PATTERN DETECTION
# ==========================================
Environment="CONSENSUS_DELTA=2"
Environment="VOL_HIGH_THRESHOLD=0.10"
Environment="VOL_LOW_THRESHOLD=0.03"
Environment="YOLO_MIN_CONF=0.12"

# ==========================================
# NEWS & SENTIMENT
# ==========================================
Environment="NEWS_LOOKBACK_HOURS=24"
Environment="NEWS_MAX_ITEMS=10"
Environment="NEWS_SOURCES=https://www.milliyet.com.tr/rss/rssnew/ekonomi.xml,https://www.ekonomidunya.com/rss_ekonomi_1.xml,https://tr.investing.com/rss/news_95.rss,https://tr.investing.com/rss/news_14.rss,https://www.ntv.com.tr/ekonomi.rss,https://www.sabah.com.tr/rss/ekonomi.xml,https://www.borsagundem.com.tr/rss"

# ==========================================
# EXTERNAL SERVICES
# ==========================================
Environment="BIST_API_URL=https://api.lotlot.net"
Environment="PUBLIC_BASE_URL=https://lotlot.net"

# ==========================================
# DEBUGGING & MONITORING
# ==========================================
Environment="DEBUG_VERBOSE=1"
Environment="TOKENIZERS_PARALLELISM=false"

# ==========================================
# ADDITIONAL CONFIGURATION (EXTRACTED FROM CODE)
# ==========================================

# API Cache Configuration
Environment="API_CACHE_MAX_SIZE=1000"
Environment="API_CACHE_TTL_WATCHLIST=5"

# Pattern Detection Extended
Environment="PATTERN_COORDINATOR_CACHE_TTL=300"
Environment="PATTERN_RESULT_CACHE_MAX_SIZE=200"
Environment="PATTERN_DATA_CACHE_TTL=60"
Environment="PATTERN_DF_CACHE_MAX_SIZE=512"
Environment="PATTERN_FAST_THRESHOLD_MS=100"
Environment="PATTERN_STANDARD_THRESHOLD_MS=500"
Environment="PATTERN_COMPREHENSIVE_THRESHOLD_MS=2000"

# Collector Configuration Extended
Environment="COLLECTOR_FETCH_CACHE_TTL=300"
Environment="COLLECTOR_NO_DATA_TTL_SECONDS=600"
Environment="COLLECTOR_HTTP_TIMEOUT=10"
Environment="COLLECTOR_NATIVE_TIMEOUT=12.0"

# ML Extended Configuration
Environment="ML_MIN_DATA_DAYS=200"
Environment="ML_MAX_MODEL_AGE_DAYS=7"
Environment="ML_TRAINING_COOLDOWN_HOURS=6"
Environment="ML_CANDIDATE_COOLDOWN_HOURS=2"
Environment="ML_TOP_POOL_SIZE=20"

# Automation Extended Configuration
Environment="AUTOMATION_CYCLE_SLEEP_SECONDS=300"
Environment="AUTOMATION_ERROR_RETRY_DELAY=30"
Environment="STATUS_CACHE_TTL=15"

# Visual Pattern Configuration
Environment="VISUAL_THREAD_POOL_WORKERS=1"

# News & Sentiment Extended
Environment="NEWS_CACHE_TTL=600"
Environment="RSS_TIMEOUT=5"

# Simulation Configuration
Environment="MIN_SIGNAL_CONFIDENCE=0.6"
Environment="SIMULATION_COMMISSION_RATE=0.001"

# Security Extended (localhost allowed for admin dashboard)
Environment="INTERNAL_ALLOW_LOCALHOST=True"
Environment="DB_PASSWORD_FILE=/opt/bist-pattern/.secrets/db_password"

# YOLO Configuration Directory
Environment="YOLO_CONFIG_DIR=/opt/bist-pattern/.cache/yolo_config"

# Manual Task Configuration (unlimited by default)
Environment="MANUAL_TASK_SYMBOL_SLEEP=0.01"
Environment="MANUAL_IGNORE_COOLDOWN=1"
